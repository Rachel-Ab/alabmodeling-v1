import { Formation } from "../models/Formation.js";

export async function getAll(req, res) {
    try {
        const docs = await Formation.findAll();
        res.status(200).json({ status: "success", data: docs });
    } catch (err) {
        res.status(500).json({ status: "error", message: err.message });
    }
}

export async function getBySlug(req, res) {
    try {
        const docs = await Formation.findOne({
            where: { slug: req.params.slug },
        });
        res.status(200).json({ status: "success", data: docs });
    } catch (err) {
        res.status(500).json({ status: "error", message: err.message });
    }
}

export async function create(req, res) {
    try {
        const docs = await Formation.create({
            name: req.body.name,
            content: req.body.content,
            year: req.body.year,
            typeId: req.body.typeId,
        });
        res.status(200).json({ status: "success", data: docs });
    } catch (err) {
        res.status(500).json({ status: "error", message: err.message });
    }
}

export async function update(req, res) {
    let docs;
    const formation = await Formation.findOne({
        where: { id: req.params.id },
    });
    try {
        docs = await formation.update(req.body);
        res.status(200).json({ status: "success", data: docs });
    } catch (err) {
        res.status(500).json({ status: "error", message: err.message });
    }
}

export async function destroy(req, res) {
    let docs;
    const formation = await Formation.findOne({
        where: { id: req.params.id },
    });
    try {
        docs = await formation.destroy({
            where: { id: req.params.id },
        });
        res.status(200).json({ status: "success", data: docs });
    } catch (err) {
        res.status(500).send(err.message);
    }
}

export async function save(req, res) {
    try {
        const doc = await Formation.create({
            name: "Formation essaie",
            content: "ceci est un test",
            year: 1995,
            typeId: 1,
        });
        res.status(200).json({ status: "success", data: doc });
    } catch (err) {
        res.status(500).send(err.message);
    }
}
